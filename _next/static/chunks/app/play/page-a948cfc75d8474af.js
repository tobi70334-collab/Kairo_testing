(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3961:function(e,t,s){Promise.resolve().then(s.bind(s,9923))},9923:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PlayPage}});var a=s(7437),r=s(2265),i=s(4033),n=s(2246);function CharacterBubble(e){let{actorId:t,name:s,children:r}=e,i=n.c[t],l=s||i.name,c="impostor"!==t,getThemeClasses=()=>{switch(i.theme){case"emerald":return"bg-emerald-100 border-emerald-200 text-emerald-900";case"rose":return"bg-rose-100 border-rose-200 text-rose-900";default:return"bg-slate-100 border-slate-200 text-slate-900"}};return"system"===t?(0,a.jsx)("div",{className:"flex justify-center my-4",children:(0,a.jsxs)("div",{className:"max-w-2xl",children:[(0,a.jsx)("div",{className:"text-center mb-2",children:(0,a.jsx)("span",{className:"text-sm font-medium text-slate-600",children:l})}),(0,a.jsx)("div",{className:"px-4 py-3 rounded-2xl border-2 ".concat(getThemeClasses()," text-center"),children:r})]})}):(0,a.jsx)("div",{className:"flex my-4 ".concat(c?"justify-start":"justify-end"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-3 max-w-2xl ".concat(c?"flex-row":"flex-row-reverse space-x-reverse"),children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:i.avatar?(0,a.jsx)("img",{src:i.avatar,alt:l,className:"w-12 h-12 rounded-full"}):(()=>{let e=i.name.split(" ").map(e=>e[0]).join("").slice(0,2),t="emerald"===i.theme?"bg-emerald-500":"rose"===i.theme?"bg-rose-500":"bg-slate-500";return(0,a.jsx)("div",{className:"w-12 h-12 rounded-full ".concat(t," flex items-center justify-center text-white font-bold text-sm"),children:e})})()}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-slate-600 mb-1 ".concat(c?"text-left":"text-right"),children:l}),(0,a.jsx)("div",{className:"px-4 py-3 rounded-2xl border-2 ".concat(getThemeClasses()," ").concat(c?"rounded-tl-sm":"rounded-tr-sm"),children:r})]})]})})}function SceneHeader(e){let{title:t,personaId:s,step:r,totalSteps:i,xp:l,progressPercent:c}=e,o=n.c[s];return(0,a.jsxs)("div",{className:"bg-white border-b border-slate-200 sticky top-0 z-10",children:[(0,a.jsx)("div",{className:"h-1 bg-gradient-to-r from-emerald-500 via-amber-500 to-rose-500",children:(0,a.jsx)("div",{className:"h-full bg-slate-200 transition-all duration-300",style:{width:"".concat(100-c,"%"),marginLeft:"auto"}})}),(0,a.jsxs)("div",{className:"px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[o.avatar?(0,a.jsx)("img",{src:o.avatar,alt:o.name,className:"w-8 h-8 rounded-full"}):(()=>{let e=o.name.split(" ").map(e=>e[0]).join("").slice(0,2),t="emerald"===o.theme?"bg-emerald-500":"rose"===o.theme?"bg-rose-500":"bg-slate-500";return(0,a.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(t," flex items-center justify-center text-white font-bold text-xs"),children:e})})(),(0,a.jsx)("span",{className:"text-sm font-medium text-slate-700",children:o.name})]}),(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:["Step ",r," of ",i]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsxs)("div",{className:"text-sm font-medium text-slate-700",children:[l," XP"]})})]}),(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("h1",{className:"text-lg font-semibold text-slate-900",children:t})})]})]})}var l=s(2542);function PlayPage(){let e=(0,i.useRouter)(),[t,s]=(0,r.useState)(null),[n,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[u,f]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[b,v]=(0,r.useState)(null),[g,j]=(0,r.useState)(null);(0,r.useEffect)(()=>{let loadScenario=async()=>{try{let e=await fetch("/scenarios/wire-transfer-mirage.json"),t=await e.json();s(t)}catch(e){console.error("Failed to load scenario:",e),s({title:"Wire Transfer Mirage",personas:[{id:"acct"},{id:"pm"}],badges:[{tier:"Bronze",xp:10}],nodes:[{id:"intro",actor:"impostor",kind:"narrative",text:"Urgent vendor payment requested: 14,900 EUR. The sender claims to be the CEO.",choices:[{id:"c1",label:"Investigate",next:"end",effects:{xp:10,bias:[],feedback:"Good choice",severity:"good"}},{id:"c2",label:"Pay immediately",next:"end",effects:{xp:-5,bias:[],feedback:"Risky",severity:"bad"}}]},{id:"end",actor:"system",kind:"end",text:"Scenario complete."}]})}},t=localStorage.getItem("kairo.persona");if(!t){e.push("/");return}d(t);let a=localStorage.getItem("kairo.state");a?c(JSON.parse(a)):c({nodeId:"intro",xp:0,bias:{},steps:0,streak:0,events:[]}),loadScenario()},[e]),(0,r.useEffect)(()=>{if(t&&n){let e=t.nodes.find(e=>e.id===n.nodeId);x(e),(null==e?void 0:e.timerSec)&&(v(e.timerSec),j(Date.now()))}},[t,n]),(0,r.useEffect)(()=>{if(b&&b>0){let e=setTimeout(()=>{v(b-1)},1e3);return()=>clearTimeout(e)}if(0===b&&m&&g){let t=Date.now()-g,s=(0,l.Cj)(m,t);if(s){var e;let t=(0,l.Vd)(n,s,"timer_expired");c(t),localStorage.setItem("kairo.state",JSON.stringify(t));let a=null===(e=m.choices)||void 0===e?void 0:e.find(e=>"caution"===e.effects.severity);a&&setTimeout(()=>{y(a)},1200)}}},[b,m,g,n]);let y=(0,r.useCallback)(s=>{if(!n||!t)return;let a=(0,l.Vd)(n,s.effects,s.id),r=t.nodes.find(e=>e.id===s.next);if(r){if("end"===r.kind){let s={xp:a.xp,bias:a.bias,badges:t.badges,events:a.events};localStorage.setItem("kairo.result",JSON.stringify(s)),localStorage.removeItem("kairo.state"),e.push("/debrief")}else{let e={...a,nodeId:s.next};c(e),localStorage.setItem("kairo.state",JSON.stringify(e)),x(r),r.timerSec?(v(r.timerSec),j(Date.now())):v(null)}}p({text:s.effects.feedback,severity:s.effects.severity}),setTimeout(()=>p(null),1200)},[n,t,e]);if((0,r.useEffect)(()=>{let handleKeyPress=e=>{if(!(null==m?void 0:m.choices))return;let t=e.key;if(t>="1"&&t<="4"){let e=parseInt(t)-1,s=m.choices[e];s&&y(s)}};return window.addEventListener("keydown",handleKeyPress),()=>window.removeEventListener("keydown",handleKeyPress)},[m,y]),!t||!n||!o||!m)return(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Loading scenario..."})]})});let N=t.nodes.filter(e=>"end"!==e.kind),w=n.steps/N.length*100;return(0,a.jsxs)("div",{className:"min-h-screen bg-slate-50",children:[(0,a.jsx)(SceneHeader,{title:t.title,personaId:o,step:n.steps+1,totalSteps:N.length,xp:n.xp,progressPercent:w}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[null!==b&&(0,a.jsx)("div",{className:"mb-4 text-center",children:(0,a.jsxs)("div",{className:"inline-block px-4 py-2 rounded-lg font-medium ".concat(b<=5?"bg-rose-100 text-rose-800":"bg-amber-100 text-amber-800"),children:["Time remaining: ",b,"s"]})}),m.evidence&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("button",{onClick:()=>f(!u),className:"w-full h-12 bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium rounded-xl transition-colors","aria-label":"Toggle evidence drawer",children:[u?"Hide":"Show"," Evidence (",m.evidence.length,")"]}),u&&(0,a.jsx)("div",{className:"mt-4 space-y-3",children:m.evidence.map(e=>(0,a.jsxs)("div",{className:"bg-white border border-slate-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-slate-900 mb-2",children:e.label}),(0,a.jsx)("p",{className:"text-sm text-slate-600",children:e.text})]},e.id))})]}),(0,a.jsx)(CharacterBubble,{actorId:m.actor,children:(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:m.text})}),m.choices&&(0,a.jsx)("div",{className:"mt-6 space-y-3",children:m.choices.map((e,t)=>(0,a.jsxs)("button",{onClick:()=>y(e),className:"w-full h-12 bg-white hover:bg-slate-50 border border-slate-200 hover:border-slate-300 text-slate-700 font-medium rounded-xl transition-colors text-left px-4","aria-label":e.label,children:[(0,a.jsxs)("span",{className:"text-slate-500 mr-2",children:[t+1,"."]}),e.label]},e.id))}),h&&(0,a.jsx)("div",{className:"mt-4 p-3 rounded-lg text-center font-medium ".concat("good"===h.severity?"bg-emerald-100 text-emerald-800":"caution"===h.severity?"bg-amber-100 text-amber-800":"bg-rose-100 text-rose-800"),children:h.text})]})]})}},2246:function(e,t,s){"use strict";s.d(t,{c:function(){return a}});let a={acct:{id:"acct",name:"Senior Accountant",avatar:"/characters/acct.svg",theme:"emerald"},pm:{id:"pm",name:"Project Manager",avatar:"/characters/pm.svg",theme:"emerald"},impostor:{id:"impostor",name:"Impostor",avatar:"/characters/impostor.svg",theme:"rose"},system:{id:"system",name:"System",avatar:"",theme:"slate"}}},2542:function(e,t,s){"use strict";function applyChoiceV2(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a={...e},r=t.xp||0;"good"===t.severity&&e.streak>0&&(r+=2),a.xp+=r,t.bias&&t.bias.forEach(e=>{a.bias[e]=(a.bias[e]||0)+1}),"good"===t.severity?a.streak+=1:a.streak=0;let i={nodeId:e.nodeId,choiceId:s,xp:r,bias:t.bias||[],ts:Date.now(),severity:t.severity||"caution"};return a.events.push(i),a.steps+=1,a}function tierFromXP(e,t){let s=t.sort((e,t)=>t.xp-e.xp);return s.find(t=>e>=t.xp)}function tickTimer(e,t){return e.timerSec&&t>1e3*e.timerSec?{xp:-5,bias:["present_bias"],feedback:"Time expired",severity:"caution"}:null}s.d(t,{Cj:function(){return tickTimer},GL:function(){return tierFromXP},Vd:function(){return applyChoiceV2}})},622:function(e,t,s){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a=s(2265),r=Symbol.for("react.element"),i=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),n=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,s){var a,c={},o=null,d=null;for(a in void 0!==s&&(o=""+s),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,a)&&!l.hasOwnProperty(a)&&(c[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===c[a]&&(c[a]=t[a]);return{$$typeof:r,type:e,key:o,ref:d,props:c,_owner:n.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,s){"use strict";e.exports=s(622)},4033:function(e,t,s){e.exports=s(94)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=3961)}),_N_E=e.O()}]);